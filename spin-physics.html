<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin Physics - Pickleball Bestie</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <style>
        .spin-ctrl-btn {
            padding: 10px 24px;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: 2px solid var(--paddle-slate);
            background: var(--white);
            color: var(--paddle-black);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.25s ease;
        }
        .spin-ctrl-btn:hover {
            background: var(--warm-gray);
            border-color: var(--paddle-black);
        }
        .spin-ctrl-btn.active {
            background: var(--paddle-black);
            color: var(--neon-yellow);
            border-color: var(--paddle-black);
        }
        #spinProgressBar {
            height: 18px;
            --progress-pct: 0%;
            background: transparent;
        }
        #spinProgressBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--neon-yellow);
            cursor: pointer;
            border: 2px solid var(--paddle-black);
            margin-top: -7.5px;
        }
        #spinProgressBar::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--neon-yellow);
            cursor: pointer;
            border: 2px solid var(--paddle-black);
        }
        #spinProgressBar::-webkit-slider-runnable-track {
            height: 3px;
            border-radius: 1.5px;
            background: linear-gradient(to right, var(--neon-yellow) var(--progress-pct), var(--paddle-slate) var(--progress-pct));
            border: 1px solid var(--paddle-black);
        }
        #spinProgressBar::-moz-range-track {
            height: 3px;
            border-radius: 1.5px;
            background: var(--paddle-slate);
            border: 1px solid var(--paddle-black);
        }
        #spinProgressBar::-moz-range-progress {
            height: 3px;
            border-radius: 1.5px;
            background: var(--neon-yellow);
            border: 1px solid var(--paddle-black);
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img class="logo-ball" src="pickleball.svg" alt="">
                PICKLEBALL BESTIE
            </a>
            <button class="hamburger" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links">
                <li><a href="fundamentals.html">Fundamentals</a></li>
                <li><a href="spin-physics.html">Spin Physics</a></li>
                <li><a href="paddle-guide.html">Paddle Guide</a></li>
                <li><a href="drills.html">Drills</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <h1>SPIN PHYSICS</h1>
        <p>Understanding the Magnus effect, friction coefficients, and trajectory mechanics that govern topspin and backspin in pickleball</p>
    </div>

    <div class="container">
        <!-- Introduction -->
        <div class="physics-section">
            <h2>The Science of Spin</h2>
            <p class="intro-text">
                When you brush the paddle across the ball, you create rotation. That rotation fundamentally changes the ball's flight path and bounce characteristics through aerodynamic forces. Understanding the physics helps you predict ball behavior, adjust your returns, and generate effective spin yourself.
            </p>

            <div class="key-insight">
                <h4>Core Principle</h4>
                <p>Spin works because rotating balls drag air around with them. This creates pressure differences that push the ball in specific directions - down for topspin, up for backspin. The faster the rotation, the stronger the effect.</p>
            </div>
        </div>

        <!-- Magnus Effect -->
        <div class="physics-section">
            <h2>The Magnus Effect</h2>

            <p class="intro-text">
                The Magnus effect is the aerodynamic force that acts on spinning objects moving through air. Named after German physicist Heinrich Magnus, this is the fundamental principle behind all ball spin in sports.
            </p>

            <div class="formula-box">
                <h4>Magnus Force Formula</h4>
                <div class="formula">
                    F<sub>M</sub> = ½ρv²AC<sub>L</sub>
                </div>
                <div class="formula-explanation">
                    <strong>Where:</strong><br>
                    F<sub>M</sub> = Magnus force (Newtons)<br>
                    ρ = air density (~1.225 kg/m³ at sea level)<br>
                    v = velocity of ball relative to air (m/s)<br>
                    A = cross-sectional area of ball (πr²)<br>
                    C<sub>L</sub> = lift coefficient (depends on spin rate and surface)
                </div>
            </div>

            <div class="diagram-container">
                <h3 class="diagram-title">Magnus Effect on Topspin Ball</h3>
                <svg class="diagram-svg" viewBox="0 0 800 400">
                    <!-- Ball with topspin rotation -->
                    <circle cx="400" cy="200" r="60" fill="#e8f442" stroke="#1a1a1a" stroke-width="3"/>

                    <!-- Rotation arrows -->
                    <path d="M 340 160 Q 360 140 390 150" fill="none" stroke="#dc3545" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <path d="M 460 240 Q 440 260 410 250" fill="none" stroke="#dc3545" stroke-width="3" marker-end="url(#arrowRed)"/>

                    <!-- Velocity vector (right) -->
                    <line x1="480" y1="200" x2="600" y2="200" stroke="#2d3436" stroke-width="4" marker-end="url(#arrowBlack)"/>
                    <text x="590" y="185" font-size="18" fill="#2d3436" font-weight="bold">v</text>

                    <!-- Air flow lines (top) -->
                    <path d="M 100 120 Q 250 110 340 130" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 100 100 Q 250 90 340 110" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="50" y="115" font-size="14" fill="#636e72">Fast air</text>

                    <!-- Air flow lines (bottom) -->
                    <path d="M 100 280 Q 250 290 340 270" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 100 300 Q 250 310 340 290" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="50" y="295" font-size="14" fill="#636e72">Slow air</text>

                    <!-- Magnus force arrow (downward) -->
                    <line x1="400" y1="280" x2="400" y2="350" stroke="#d4ff00" stroke-width="6" marker-end="url(#arrowYellow)"/>
                    <text x="420" y="325" font-size="20" fill="#1a1a1a" font-weight="bold">F<tspan font-size="14" baseline-shift="sub">Magnus</tspan></text>

                    <!-- Labels -->
                    <text x="400" y="30" text-anchor="middle" font-size="22" fill="#1a1a1a" font-weight="bold">TOPSPIN</text>
                    <text x="400" y="380" text-anchor="middle" font-size="16" fill="#636e72">Ball curves downward</text>

                    <!-- Pressure indicators -->
                    <text x="400" y="140" text-anchor="middle" font-size="14" fill="#dc3545" font-weight="bold">Low Pressure</text>
                    <text x="400" y="340" text-anchor="middle" font-size="14" fill="#17a2b8" font-weight="bold">High Pressure</text>

                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#dc3545" />
                        </marker>
                        <marker id="arrowBlack" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2d3436" />
                        </marker>
                        <marker id="arrowYellow" markerWidth="12" markerHeight="12" refX="6" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L12,3 z" fill="#d4ff00" />
                        </marker>
                    </defs>
                </svg>
            </div>

            <div class="scientific-note">
                <h4>What's Happening Physically</h4>
                <p>
                    The rotating ball drags a thin boundary layer of air with it. On the top of a topspin ball, this layer moves in the same direction as the ball's forward motion, creating fast-moving air and low pressure (Bernoulli's principle). On the bottom, the boundary layer moves against the ball's motion, creating slow-moving air and high pressure. The pressure difference creates a net downward force.
                </p>
            </div>

            <div class="diagram-container">
                <h3 class="diagram-title">Magnus Effect on Backspin Ball</h3>
                <svg class="diagram-svg" viewBox="0 0 800 400">
                    <!-- Ball with backspin rotation -->
                    <circle cx="400" cy="200" r="60" fill="#e8f442" stroke="#1a1a1a" stroke-width="3"/>

                    <!-- Rotation arrows (opposite direction) -->
                    <path d="M 460 160 Q 440 140 410 150" fill="none" stroke="#dc3545" stroke-width="3" marker-end="url(#arrowRed2)"/>
                    <path d="M 340 240 Q 360 260 390 250" fill="none" stroke="#dc3545" stroke-width="3" marker-end="url(#arrowRed2)"/>

                    <!-- Velocity vector -->
                    <line x1="480" y1="200" x2="600" y2="200" stroke="#2d3436" stroke-width="4" marker-end="url(#arrowBlack2)"/>
                    <text x="590" y="185" font-size="18" fill="#2d3436" font-weight="bold">v</text>

                    <!-- Air flow lines (top) - slow -->
                    <path d="M 100 120 Q 250 110 340 130" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 100 100 Q 250 90 340 110" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="50" y="115" font-size="14" fill="#636e72">Slow air</text>

                    <!-- Air flow lines (bottom) - fast -->
                    <path d="M 100 280 Q 250 290 340 270" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 100 300 Q 250 310 340 290" fill="none" stroke="#636e72" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="50" y="295" font-size="14" fill="#636e72">Fast air</text>

                    <!-- Magnus force arrow (upward) -->
                    <line x1="400" y1="120" x2="400" y2="50" stroke="#d4ff00" stroke-width="6" marker-end="url(#arrowYellow2)"/>
                    <text x="420" y="95" font-size="20" fill="#1a1a1a" font-weight="bold">F<tspan font-size="14" baseline-shift="sub">Magnus</tspan></text>

                    <!-- Labels -->
                    <text x="400" y="30" text-anchor="middle" font-size="22" fill="#1a1a1a" font-weight="bold">BACKSPIN</text>
                    <text x="400" y="380" text-anchor="middle" font-size="16" fill="#636e72">Ball floats / curves upward</text>

                    <!-- Pressure indicators -->
                    <text x="400" y="150" text-anchor="middle" font-size="14" fill="#17a2b8" font-weight="bold">High Pressure</text>
                    <text x="400" y="330" text-anchor="middle" font-size="14" fill="#dc3545" font-weight="bold">Low Pressure</text>

                    <defs>
                        <marker id="arrowRed2" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#dc3545" />
                        </marker>
                        <marker id="arrowBlack2" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2d3436" />
                        </marker>
                        <marker id="arrowYellow2" markerWidth="12" markerHeight="12" refX="6" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L12,3 z" fill="#d4ff00" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <!-- Ball Trajectories -->
        <div class="physics-section">
            <h2>Trajectory Mechanics</h2>

            <p class="intro-text">
                The Magnus force combines with gravity to create distinctive flight paths. Understanding these trajectories helps you predict where the ball will land and how it will bounce.
            </p>

            <div class="diagram-container">
                <h3 class="diagram-title">Flight Path Comparison</h3>
                <canvas id="spinTrajectoryCanvas" style="display:block; width:100%; border-radius:8px;"></canvas>
                <div style="margin-top:16px; display:flex; flex-direction:column; gap:12px; max-width:100%;">
                    <input type="range" id="spinProgressBar" min="0" max="1000" value="0"
                        style="width:100%; cursor:pointer; -webkit-appearance:none; appearance:none;">
                    <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                        <button id="spinPlayPauseBtn" class="spin-ctrl-btn">Play</button>
                        <button id="spinResetBtn" class="spin-ctrl-btn">Reset</button>
                    </div>
                </div>
            </div>

            <div class="formula-box">
                <h4>Trajectory Equations</h4>
                <div class="formula">
                    y(t) = y₀ + v<sub>y</sub>t - ½gt² + ∫(F<sub>M</sub>/m)dt
                </div>
                <div class="formula-explanation">
                    Position depends on: initial height (y₀), vertical velocity (v<sub>y</sub>), gravity acceleration (g = 9.81 m/s²), and accumulated Magnus force effect over time. The Magnus term is what differentiates spin trajectories from simple parabolic motion.
                </div>
            </div>
        </div>

        <!-- Bounce Mechanics -->
        <div class="physics-section">
            <h2>Bounce Characteristics</h2>

            <p class="intro-text">
                The spin dramatically affects what happens when the ball contacts the court surface. This is governed by the coefficient of restitution and friction between ball and surface.
            </p>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h4>Topspin Bounce</h4>
                    <ul>
                        <li><strong>Kicks upward:</strong> Forward rotation accelerates the bounce</li>
                        <li><strong>Accelerates forward:</strong> Ball speeds up after contact</li>
                        <li><strong>Bounces higher:</strong> Vertical component increases</li>
                        <li><strong>Friction amplifies spin:</strong> Rough surfaces enhance effect</li>
                    </ul>
                </div>

                <div class="comparison-card">
                    <h4>Backspin Bounce</h4>
                    <ul>
                        <li><strong>Stays low:</strong> Backward rotation suppresses bounce height</li>
                        <li><strong>Decelerates:</strong> Ball slows down after contact</li>
                        <li><strong>Can bounce backward:</strong> With heavy spin on rough surfaces</li>
                        <li><strong>Floats after bounce:</strong> Reduced forward velocity</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-container">
                <h3 class="diagram-title">Bounce Vector Analysis</h3>
                <svg class="diagram-svg" viewBox="0 0 800 400">
                    <!-- Ground -->
                    <line x1="50" y1="300" x2="750" y2="300" stroke="#1a1a1a" stroke-width="4"/>
                    <rect x="50" y="300" width="700" height="20" fill="#98d8c8"/>

                    <!-- Topspin bounce (left side) -->
                    <g>
                        <text x="200" y="50" text-anchor="middle" font-size="20" fill="#00b894" font-weight="bold">TOPSPIN</text>

                        <!-- Incoming ball -->
                        <circle cx="150" cy="200" r="20" fill="#e8f442" opacity="0.5"/>
                        <path d="M 150 200 L 200 280" stroke="#00b894" stroke-width="3" marker-end="url(#arrowGreen)"/>
                        <text x="120" y="240" font-size="14" fill="#00b894">v<tspan baseline-shift="sub" font-size="10">in</tspan></text>

                        <!-- Bounce point -->
                        <circle cx="200" cy="300" r="8" fill="#dc3545"/>

                        <!-- Outgoing ball -->
                        <circle cx="280" cy="200" r="20" fill="#e8f442" opacity="0.5"/>
                        <path d="M 200 280 L 280 180" stroke="#00b894" stroke-width="3" marker-end="url(#arrowGreen)"/>
                        <text x="250" y="220" font-size="14" fill="#00b894">v<tspan baseline-shift="sub" font-size="10">out</tspan></text>

                        <!-- Annotations -->
                        <text x="200" y="350" text-anchor="middle" font-size="13" fill="#636e72">Kicks up & forward</text>
                    </g>

                    <!-- Backspin bounce (right side) -->
                    <g>
                        <text x="600" y="50" text-anchor="middle" font-size="20" fill="#e74c3c" font-weight="bold">BACKSPIN</text>

                        <!-- Incoming ball -->
                        <circle cx="550" cy="200" r="20" fill="#e8f442" opacity="0.5"/>
                        <path d="M 550 200 L 600 280" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowRed3)"/>
                        <text x="520" y="240" font-size="14" fill="#e74c3c">v<tspan baseline-shift="sub" font-size="10">in</tspan></text>

                        <!-- Bounce point -->
                        <circle cx="600" cy="300" r="8" fill="#dc3545"/>

                        <!-- Outgoing ball (lower trajectory) -->
                        <circle cx="680" cy="240" r="20" fill="#e8f442" opacity="0.5"/>
                        <path d="M 600 280 L 680 250" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrowRed3)"/>
                        <text x="650" y="260" font-size="14" fill="#e74c3c">v<tspan baseline-shift="sub" font-size="10">out</tspan></text>

                        <!-- Annotations -->
                        <text x="600" y="350" text-anchor="middle" font-size="13" fill="#636e72">Stays low & slow</text>
                    </g>

                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00b894" />
                        </marker>
                        <marker id="arrowRed3" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c" />
                        </marker>
                    </defs>
                </svg>
            </div>

            <div class="scientific-note">
                <h4>Coefficient of Restitution (COR)</h4>
                <p>
                    COR = v<sub>out</sub> / v<sub>in</sub> measures how much velocity is retained after bounce. For pickleballs on court surfaces, COR ≈ 0.70-0.80. Topspin increases effective COR in the forward direction due to friction-spin coupling. Backspin decreases it, making the ball "die" on contact.
                </p>
            </div>
        </div>

        <!-- Practical Application -->
        <div class="physics-section">
            <div class="practical-app">
                <h3>Applying Physics to Your Game</h3>

                <p><strong>When Returning Topspin:</strong></p>
                <ul>
                    <li>Ball will kick up higher and faster than it looks</li>
                    <li>Take the ball earlier (at top of bounce or on the rise)</li>
                    <li>Contact point should be higher in your strike zone</li>
                    <li>Use a flatter or counter-spin swing (slice) to neutralize</li>
                    <li>Absorb pace - don't add to the existing energy</li>
                </ul>

                <p style="margin-top: 30px;"><strong>When Returning Backspin:</strong></p>
                <ul>
                    <li>Ball will stay lower and slower than expected</li>
                    <li>Get lower in your stance to contact below the ball</li>
                    <li>Provide your own lift - the ball won't rise on its own</li>
                    <li>Add forward swing to compensate for reduced pace</li>
                    <li>Expect the ball to "float" or "die" after the bounce</li>
                </ul>

                <p style="margin-top: 30px;"><strong>Generating Your Own Spin:</strong></p>
                <ul>
                    <li><strong>Topspin:</strong> Brush up the back of the ball (low to high swing path)</li>
                    <li><strong>Backspin:</strong> Brush down the back of the ball (high to low swing path)</li>
                    <li><strong>Spin rate matters:</strong> Faster brushing = stronger Magnus effect</li>
                    <li><strong>Contact angle:</strong> Slightly closed face for topspin, open for slice</li>
                    <li><strong>Racquet speed > power:</strong> Spin comes from velocity, not force</li>
                </ul>
            </div>
        </div>

        <!-- Advanced Topics -->
        <div class="physics-section">
            <h2>Advanced Considerations</h2>

            <h3>Environmental Factors</h3>
            <p>The Magnus effect is influenced by air density, which varies with altitude, temperature, and humidity:</p>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h4>High Altitude</h4>
                    <ul>
                        <li>Lower air density (ρ decreases)</li>
                        <li>Weaker Magnus force</li>
                        <li>Less spin effect on trajectory</li>
                        <li>Ball travels faster and farther</li>
                    </ul>
                </div>

                <div class="comparison-card">
                    <h4>High Humidity</h4>
                    <ul>
                        <li>Slightly lower air density</li>
                        <li>Ball absorbs moisture (increases mass)</li>
                        <li>Reduced Magnus effect relative to ball weight</li>
                        <li>Spin effectiveness decreases</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 50px;">Surface Texture Effects</h3>
            <p>The pickleball's surface texture (40 holes) creates turbulent boundary layers that enhance spin grip:</p>

            <div class="key-insight">
                <h4>Ball Surface Mechanics</h4>
                <p>
                    Unlike smooth balls, the pickleball's perforated surface creates micro-vortices in the boundary layer. These increase the effective friction coefficient with air, making the Magnus effect more pronounced at lower spin rates. This is why even moderate brush contact produces noticeable spin in pickleball compared to other racquet sports.
                </p>
            </div>

            <div class="formula-box">
                <h4>Spin Decay Over Time</h4>
                <div class="formula">
                    ω(t) = ω₀e<sup>-kt</sup>
                </div>
                <div class="formula-explanation">
                    Spin rate (ω) decays exponentially due to air resistance. The decay constant (k) depends on surface texture and air density. Pickleballs lose approximately 30-40% of initial spin rate over a typical rally distance (30 feet), meaning the Magnus effect weakens as the ball travels.
                </div>
            </div>
        </div>

        <!-- Conclusion -->
        <div class="physics-section">
            <h2>Summary: Why This Matters</h2>

            <p class="intro-text">
                Understanding spin physics transforms intuition into predictable strategy. When you see your opponent's paddle angle and swing path, you can predict:
            </p>

            <ul style="font-size: 1.05rem; line-height: 2; margin: 24px 0 24px 36px;">
                <li><strong>Flight trajectory:</strong> How the ball will curve in the air</li>
                <li><strong>Bounce behavior:</strong> Where and how high it will kick</li>
                <li><strong>Required adjustment:</strong> Your contact point and swing path to counter</li>
                <li><strong>Optimal response:</strong> Whether to flatten, counter-spin, or absorb</li>
            </ul>

            <p class="intro-text">
                The Magnus effect, bounce mechanics, and spin decay aren't just abstract concepts - they're the physical laws governing every rally. Master the physics, and you'll stop reacting to surprises and start executing with precision.
            </p>
        </div>
    </div>

    <script>
        document.querySelector('.hamburger').addEventListener('click', function() {
            this.classList.toggle('active');
            document.querySelector('.nav-links').classList.toggle('active');
        });
    </script>
    <script>
    (function() {
        var canvas = document.getElementById('spinTrajectoryCanvas');
        if (!canvas) return;
        var ctx = canvas.getContext('2d');
        var progressBar = document.getElementById('spinProgressBar');
        var playPauseBtn = document.getElementById('spinPlayPauseBtn');
        var resetBtn = document.getElementById('spinResetBtn');

        var cWidth, cHeight;
        var dpr = window.devicePixelRatio || 1;

        // Fixed simulation space — always 800x400
        var SIM_W = 800, SIM_H = 400;
        var SIM_GROUND = SIM_H - 50;
        var SIM_START_X = 50;
        var SIM_START_Y = SIM_GROUND - 20;
        var GRAVITY = 0.4;

        var isPlaying = false;
        var currentFrame = 0;
        var animationId = null;
        var trajData = [];
        var maxPoints = 0;

        function updateProgressFill() {
            var pct = (progressBar.value / progressBar.max) * 100 || 0;
            // Remove background from input itself; inject gradient into track via stylesheet
            progressBar.style.setProperty('--progress-pct', pct + '%');
        }

        // Scale factor from sim coords to canvas coords
        var scaleX, scaleY;

        function resizeCanvas() {
            var rect = canvas.parentElement.getBoundingClientRect();
            cWidth = rect.width;
            cHeight = cWidth * 0.5;
            canvas.width = cWidth * dpr;
            canvas.height = cHeight * dpr;
            canvas.style.height = cHeight + 'px';
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            scaleX = cWidth / SIM_W;
            scaleY = cHeight / SIM_H;
            drawScene();
        }

        function sx(x) { return x * scaleX; }
        function sy(y) { return y * scaleY; }

        function Trajectory(type, color, labelOffset) {
            this.type = type;
            this.color = color;
            this.labelOffset = labelOffset;
            this.points = [];
            this.highestPoint = null;
        }

        Trajectory.prototype.calculate = function() {
            this.points = [];
            this.highestPoint = null;
            var x = SIM_START_X, y = SIM_START_Y;
            var vx = 8;
            var vy;
            if (this.type === 'topspin') vy = -11;
            else if (this.type === 'backspin') vy = -9;
            else vy = -10;
            var bounced = false, minY = y;
            while (x < SIM_W && this.points.length < 300) {
                this.points.push({x: x, y: y});
                if (y < minY) { minY = y; this.highestPoint = {x: x, y: y}; }
                vy += GRAVITY;
                if (this.type === 'topspin') vy += 0.18;
                else if (this.type === 'backspin') vy -= 0.12;
                var nextX = x + vx, nextY = y + vy;
                if (nextY >= SIM_GROUND && !bounced) {
                    var t = (SIM_GROUND - y) / (nextY - y);
                    var ix = x + vx * t;
                    this.points.push({x: ix, y: SIM_GROUND});
                    x = ix; y = SIM_GROUND; vy *= -0.6;
                    if (this.type === 'topspin') { vx *= 1.15; vy *= 1.2; }
                    else if (this.type === 'backspin') { vx *= 0.65; vy *= 0.5; }
                    else { vx *= 0.9; vy *= 0.8; }
                    bounced = true;
                } else { x = nextX; y = nextY; }
                if (bounced && y > SIM_GROUND) { this.points.push({x: x, y: SIM_GROUND}); break; }
            }
        };

        Trajectory.prototype.draw = function() {
            ctx.strokeStyle = this.color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (var i = 0; i < this.points.length; i++) {
                if (i === 0) ctx.moveTo(sx(this.points[i].x), sy(this.points[i].y));
                else ctx.lineTo(sx(this.points[i].x), sy(this.points[i].y));
            }
            ctx.stroke();
            if (this.highestPoint) {
                var fontSize = Math.max(12, cWidth * 0.018);
                ctx.font = 'bold ' + fontSize + 'px "DM Sans", sans-serif';
                var label = this.type.charAt(0).toUpperCase() + this.type.slice(1);
                // Position labels away from curves: backspin above, flat to the right, topspin below
                var lx, ly;
                if (this.type === 'backspin') {
                    lx = sx(this.highestPoint.x) + 15;
                    ly = sy(this.highestPoint.y) - fontSize;
                } else if (this.type === 'topspin') {
                    lx = sx(this.highestPoint.x) + 40;
                    ly = sy(this.highestPoint.y) + fontSize + 6;
                } else {
                    lx = sx(this.highestPoint.x) + 15;
                    ly = sy(this.highestPoint.y) - fontSize * 0.4;
                }
                ctx.save();
                ctx.shadowColor = 'rgba(0,0,0,0.6)';
                ctx.shadowBlur = 1;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                ctx.fillStyle = this.color;
                ctx.fillText(label, lx, ly);
                ctx.restore();
            }
        };

        Trajectory.prototype.drawBall = function(frameIndex) {
            var idx = Math.min(frameIndex, this.points.length - 1);
            if (idx >= 0 && idx < this.points.length) {
                var p = this.points[idx];
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(sx(p.x), sy(p.y), Math.max(6, cWidth * 0.01), 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        };

        function recalculate() {
            trajData = [
                new Trajectory('backspin', '#5ba4cf', -10),
                new Trajectory('flat', '#7b8794', 0),
                new Trajectory('topspin', '#00b894', 10)
            ];
            trajData.forEach(function(t) { t.calculate(); });
            maxPoints = Math.max.apply(null, trajData.map(function(t) { return t.points.length; }));
            progressBar.max = maxPoints;
            if (currentFrame > maxPoints) currentFrame = maxPoints;
        }

        function drawScene() {
            ctx.clearRect(0, 0, cWidth, cHeight);
            ctx.fillStyle = '#f2f8fc';
            ctx.fillRect(0, 0, cWidth, cHeight);
            // Ground line
            ctx.strokeStyle = '#3d4852';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, sy(SIM_GROUND));
            ctx.lineTo(cWidth, sy(SIM_GROUND));
            ctx.stroke();
            ctx.setLineDash([]);
            // Trajectories
            trajData.forEach(function(t) { t.draw(); });
            // Contact point
            ctx.fillStyle = '#1a1a1a';
            ctx.beginPath();
            ctx.arc(sx(SIM_START_X), sy(SIM_START_Y), 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#3d4852';
            ctx.font = 'bold ' + Math.max(11, cWidth * 0.015) + 'px "DM Sans", sans-serif';
            ctx.fillText('Contact Point', sx(SIM_START_X) - cWidth * 0.05, sy(SIM_START_Y) - 10);
            // Balls
            trajData.forEach(function(t) { t.drawBall(currentFrame); });
        }

        function animate() {
            if (isPlaying && currentFrame < maxPoints) {
                currentFrame += 1;
                progressBar.value = currentFrame;
                updateProgressFill();
                drawScene();
                animationId = requestAnimationFrame(animate);
            } else if (currentFrame >= maxPoints) {
                isPlaying = false;
                playPauseBtn.textContent = 'Play';
                playPauseBtn.classList.remove('active');
            }
        }

        playPauseBtn.addEventListener('click', function() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                playPauseBtn.textContent = 'Pause';
                playPauseBtn.classList.add('active');
                if (currentFrame >= maxPoints) currentFrame = 0;
                animate();
            } else {
                playPauseBtn.textContent = 'Play';
                playPauseBtn.classList.remove('active');
                if (animationId) cancelAnimationFrame(animationId);
            }
        });

        resetBtn.addEventListener('click', function() {
            isPlaying = false;
            currentFrame = 0;
            progressBar.value = 0;
            updateProgressFill();
            playPauseBtn.textContent = 'Play';
            playPauseBtn.classList.remove('active');
            if (animationId) cancelAnimationFrame(animationId);
            drawScene();
        });

        progressBar.addEventListener('input', function(e) {
            currentFrame = parseInt(e.target.value);
            updateProgressFill();
            drawScene();
        });

        window.addEventListener('resize', resizeCanvas);
        recalculate();
        resizeCanvas();
        updateProgressFill();
    })();
    </script>
</body>
</html>
